<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood Bartender Pro</title>
    <!-- å¼•å…¥ Vue 3 & GSAP -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- å¼•å…¥ Tailwind CSS (æ ·å¼å¼•æ“) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥å­—ä½“: Playfair Display (æ ‡é¢˜) & Inter (æ­£æ–‡) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

    <style>
        /* --- 1. è®¾è®¡ç³»ç»Ÿ & å˜é‡ --- */
        :root {
            --bg-deep: #1a1816; /* æ·±æ£•è‰²åŸºåº• */
            --bg-gradient: radial-gradient(circle at 50% 30%, #2c2824 0%, #1a1816 80%, #0d0c0b 100%);
            
            --gold-accent: #D4C5A8; /* æš–é‡‘è‰²é«˜å…‰ */
            --gold-dim: rgba(212, 197, 168, 0.4);
            
            --glass-card: rgba(30, 30, 30, 0.4);
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(212, 197, 168, 0.12);
            
            --font-serif: 'Playfair Display', serif;
            --font-sans: 'Inter', sans-serif;

            --text-main: #EAE6df;
            --text-muted: rgba(234, 230, 223, 0.5);
          
            --accent-gold: #D4C5A8;

            /* æ–°å¢ï¼šæ¶²ä½“é¢œè‰²å˜é‡ */
            --liquidStart: #E8A348;
            --liquidEnd: #D67C65;
            /* æ–°å¢ï¼šæ©™è‰²æ¸å˜å˜é‡ï¼ˆæ›¿ä»£Tailwindçš„bg-orange-500/20ï¼‰ */
            --orange-light: rgba(249, 115, 22, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: var(--bg-deep);
            color: var(--gold-accent);
            font-family: var(--font-sans);
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- 2. å…¨å±€å™ªç‚¹æ»¤é•œ (Grain Effect) --- */
        .grain-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.07;
            filter: url(#noiseFilter);
        }

        /* --- 3. å®¹å™¨ä¸å¸ƒå±€ --- */
        .app-frame {
            position: relative;
            z-index: 1;
            width: 375px;
            height: 812px;
            background: var(--bg-gradient);
            border-radius: 40px;
            box-shadow: 0 40px 80px rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.05);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .view-section {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            padding: 32px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
            display: flex;
            flex-direction: column;
        }
        .view-section.active {
            opacity: 1;
            pointer-events: auto;
            z-index: 10;
        }

        /* é¡¶éƒ¨å¯¼èˆªåŒº */
        .nav-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 20px;
        }
        .nav-icon { cursor: pointer; opacity: 0.7; transition: 0.3s; }
        .nav-icon:hover { opacity: 1; transform: scale(1.1); }

        /* --- 4. å­—ä½“æ’å° --- */
        h1, h2, h3 {
            font-family: var(--font-serif);
            font-weight: 400;
        }
        .title-main {
            /* font-size: 36px;
            line-height: 1.2;
            margin-bottom: 10px;
            color: #fff;
            letter-spacing: 0.02em; */
            font-family: var(--font-serif); font-size: 36px; line-height: 1.2;
            margin-bottom: 5px; color: var(--accent-gold); text-align: center;
        }
        .subtitle {
            font-family: var(--font-sans);
            font-size: 14px;
            color: var(--gold-dim);
            letter-spacing: 0.05em;
            text-transform: uppercase;
            text-align: center;
            margin-top: 5px;
            
        }

        /* --- 5. é¦–é¡µç»„ä»¶ --- */
        /* textarea.mood-input {
            width: 100%;
            height: 120px;
            background: transparent;
            border: none;
            color: #fff;
            font-family: var(--font-serif);
            font-size: 20px;
            line-height: 1.6;
            resize: none;
            outline: none;
            margin-top: 20px;
        }
        textarea.mood-input::placeholder { color: rgba(255,255,255,0.2); font-style: italic; } */

        textarea.mood-input {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 20px;
            backdrop-filter: blur(10px);
            margin-top: 10px;
            margin-bottom: 10px;

            width: 100%; height: 100px; 
            color: var(--text-main); font-size: 16px; line-height: 1.5; outline: none; resize: none;
            font-family: var(--font-serif);
        }
        textarea.mood-input::placeholder { color: var(--text-muted); font-style: italic; }

        .tags-container {
            /* display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 30px; */
            display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 30px;
        }
        .tag {
            /* padding: 8px 16px;
            border: 1px solid var(--glass-border);
            border-radius: 100px;
            font-size: 12px;
            color: var(--gold-accent);
            cursor: pointer;
            transition: all 0.4s ease;
            background: rgba(255,255,255,0.01); */
            padding: 8px 16px; border-radius: 20px; border: 1px solid var(--glass-border);
            font-size: 12px; color: var(--text-muted); transition: 0.3s; cursor: pointer;
        }
        .tag.selected {
            background: var(--gold-accent);
            color: #1a1816;
            border-color: var(--gold-accent);
        }

        .action-area {
            margin-top: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* æŒ‰é’®é£æ ¼ï¼šæç®€ã€å‘¼å¸æ„Ÿ */
        /* .btn-primary {
            width: 100%;
            padding: 22px;
            background: rgba(212, 197, 168, 0.1);
            color: #fff;
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            font-family: var(--font-sans);
            font-size: 14px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.5s ease;
            backdrop-filter: blur(10px);
        }
        .btn-primary:hover {
            background: rgba(212, 197, 168, 0.2);
            border-color: rgba(212, 197, 168, 0.4);
        }
        .btn-mystery {
            text-align: center;
            font-size: 12px;
            color: var(--gold-dim);
            cursor: pointer;
            letter-spacing: 0.05em;
        } */

        .btn-mystery {
            text-align: center;
            font-size: 12px;
            color: var(--gold-dim);
            cursor: pointer;
            letter-spacing: 0.05em;
        }
         /* åº•éƒ¨æŒ‰é’®ç»„ */
        .btn-group { margin-top: auto; display: flex; gap: 15px; }
        .btn-primary {
            flex: 2; height: 56px; border-radius: 28px; border: none;
            background: var(--text-main); color: #000;
            font-size: 16px; font-weight: 600; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-icon {
            flex: 1; height: 56px; border-radius: 28px; border: 1px solid var(--glass-border);
            background: transparent; color: var(--text-main); cursor: pointer;
            display: grid; place-items: center; font-size: 20px;
        }
        .btn-icon2 {
            flex: 2; height: 56px; border-radius: 28px; border: 1px solid var(--glass-border);
            background: transparent; color: var(--text-main); cursor: pointer;
            font-size: 16px; font-weight: 600; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }

         /* ===================è¶…ç¾åŠ¨æ€æ¶²é¢====================== */

        /* å‘¼å¸å…‰æ™•åŠ¨ç”» */
        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.1); opacity: 0.5; }
        }
        .animate-breathe {
            animation: breathe 6s ease-in-out infinite;
        }

        /* æ¶²ä½“ä¸Šå‡åŠ¨ç”» */
        @keyframes liquid-rise {
            0% { transform: translateY(100%); }
            100% { transform: translateY(0); } /* è¿™é‡Œçš„0æ˜¯ç›¸å¯¹çˆ¶å®¹å™¨å®šä½çš„ä½ç½® */
        }
        .liquid-enter {
            animation: liquid-rise 2s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        }

        /* æ¶²é¢å¾®æ³¢ç²¼ç²¼ */
        @keyframes surface-shimmer {
            0%, 100% { transform: translateY(-2px); }
            50% { transform: translateY(2px); }
        }
        .liquid-surface {
            animation: surface-shimmer 4s ease-in-out infinite;
        }

        /* æ°”æ³¡ä¸Šå‡ */
        @keyframes bubble-up {
            0% { bottom: -10px; opacity: 0; transform: translateX(0); }
            50% { opacity: 0.8; }
            100% { bottom: 80%; opacity: 0; transform: translateX(10px); }
        }
        .bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            animation: bubble-up 3s linear infinite;
        }

        /* æµ“åº¦æ¡åŠ è½½ */
        @keyframes width-grow {
            from { width: 0; }
            to { width: 59%; }
        }
        .progress-bar {
            animation: width-grow 1.5s ease-out 0.5s forwards;
            width: 0; /* åˆå§‹çŠ¶æ€ */
        }

        /* æ–°å¢ï¼šç»“æœå¡ç‰‡æ·¡å…¥åŠ¨ç”» */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(16px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            opacity: 0;
            transform: translateY(16px);
            animation: fadeInUp 0.8s ease-out 0.3s forwards;
        }

        /* æ–°å¢ï¼šé¡µé¢æ·¡å‡ºåŠ¨ç”»ï¼ˆå†è°ƒä¸€æ¯ï¼‰ */
        .page-fade-out {
            opacity: 0 !important;
            transition: opacity 0.5s ease !important;
        }
        /* ========================================= */

        /* --- 6. è°ƒåˆ¶è¿‡ç¨‹ï¼ˆæµä½“ï¼‰ --- */
        .mixing-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        /* æ¨¡æ‹Ÿæ¶²ä½“ Blob */
        .fluid-blob {
            width: 200px;
            height: 200px;
            background: var(--gold-accent); /* é»˜è®¤è‰² */
            border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
            animation: morph 6s linear infinite;
            filter: blur(15px);
            opacity: 0.8;
            transition: background 2s ease;
            position: relative;
        }
        /* å†…éƒ¨æ°”æ³¡ */
        /* .bubble {
            position: absolute;
            background: rgba(255,255,255,0.6);
            border-radius: 50%;
            animation: rise 4s infinite ease-in;
        } */

        @keyframes morph {
            0%, 100% { border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; transform: rotate(0deg); }
            34% { border-radius: 70% 30% 50% 50% / 30% 30% 70% 70%; }
            67% { border-radius: 100% 60% 60% 100% / 100% 100% 60% 60%; }
            100% { transform: rotate(360deg); }
        }
        @keyframes rise {
            0% { transform: translateY(0) scale(1); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(-100px) scale(0.5); opacity: 0; }
        }

        .poetic-ingredient {
            margin-top: 40px;
            font-family: var(--font-serif);
            font-style: italic;
            font-size: 18px;
            color: rgba(255,255,255,0.8);
            text-align: center;
            min-height: 30px;
        }

        /* --- 7. ç»“æœé¡µ (é‡éœœç»ç’ƒ) --- */
        .result-glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 30px;
            padding: 20px 20px;
            text-align: center;
            margin-top: 10px;
            /* box-shadow: 0 20px 40px rgba(0,0,0,0.4); */
            position: relative;
            min-height: 400px; /* å¢åŠ æœ€å°é«˜åº¦ */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        /* ç»“æœé¡µèƒŒæ™¯æ¨¡ç³ŠæŠ˜å°„ */
        .bg-refraction {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0;
            filter: blur(4px); /* åšç»ç’ƒæ„Ÿ */
            transition: background 2s ease, opacity 0.4s ease;
            opacity: 0.4; /* æ–°å¢ï¼šæ•´ä½“é™ä½æŠ˜å°„å±‚çš„ä¸é€æ˜åº¦ï¼Œ0.8æ¯”1æ›´æ·¡ */
            pointer-events: none;
        }

        .drink-name { font-size: 28px; margin-bottom: 8px; color: #fff; }
        .drink-en { font-family: var(--font-sans); font-size: 12px; color: var(--gold-dim); margin-bottom: 20px; letter-spacing: 0.1em; text-transform: uppercase; }

        .formula-list { text-align: left; margin-top: 20px; }
        .formula-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 16px;
            font-size: 13px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            padding-bottom: 8px;
        }
        .f-key { color: var(--gold-dim); }
        .f-val { color: #ddd; font-weight: 500; }

        /* --- 8. é…’å•æ”¶è—é¡µ --- */
        .history-list {
            overflow-y: auto;
            flex: 1;
            padding-right: 5px;
        }
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            transition: 0.2s;
        }
        .history-item:hover { background: rgba(255,255,255,0.02); }
        .h-info h4 { font-size: 16px; color: #fff; margin-bottom: 4px; }
        .h-date { font-size: 11px; color: var(--gold-dim); }
        .h-emoji { font-size: 24px; }

        /* æ»šåŠ¨æ¡éšè— */
        ::-webkit-scrollbar { width: 0px; }

    </style>
</head>
<body>

<!-- SVG å™ªç‚¹æ»¤é•œå®šä¹‰ -->
<svg style="display: none;">
    <filter id="noiseFilter">
        <feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="3" stitchTiles="stitch"/>
        <feColorMatrix type="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 0.5 0"/>
    </filter>
</svg>

<!-- èƒŒæ™¯å™ªç‚¹å±‚ -->
<div class="grain-overlay"></div>

<div id="app" class="app-frame">
    
    <!-- 1. é¦–é¡µ: æƒ…ç»ªæ„ŸçŸ¥ -->
    <div class="view-section" :class="{ active: currentView === 'home' }">
        <div class="nav-bar">
            <span class="subtitle">Mood Bartender</span>
            <div style="display: flex; gap: 10px;">
                <span class="nav-icon" @click="goToHistory">ğŸ“œ </span>
                <span class="nav-icon" @click="goToCollection">â¤ï¸</span>
            </div>
        </div>
        
        <div style="flex:1; display:flex; flex-direction:column; justify-content:center;">
            <h1 class="title-main">How is your soul<br>breathing today?</h1>
            <div class="subtitle">Tell us your story</div>

            <textarea 
                class="mood-input" 
                placeholder="Input your mood..." 
                v-model="inputText"
            ></textarea>

            <!-- æ–°å¢ï¼šæƒ…ç»ªæ ‡ç­¾åŒºåŸŸï¼ˆä½ç½®ï¼štextarea ä¸‹æ–¹ï¼Œtags-container ä¸Šæ–¹ï¼‰ -->
            <div class="tags-container" style="margin-top: 20px;">
                <div 
                class="tag" 
                v-for="mood in moodOptions" 
                :key="mood"
                @click="selectMoodTag(mood)"
                >
                {{ mood }}
                </div>
            </div>

            <!-- å‘³è§‰æ ‡ç­¾ -->
            <div class="tags-container">
                <div 
                    class="tag" 
                    v-for="flavor in flavorOptions" 
                    :key="flavor"
                    :class="{ selected: selectedFlavors.includes(flavor) }"
                    @click="toggleFlavor(flavor)"
                >
                    {{ flavor }}
                </div>
            </div>
        </div>

        <!-- <div class="action-area">
            <button class="btn-primary" @click="startMixing(null)">
                Start Mixing
            </button>
            <div class="btn-mystery" @click="startBlindBox">
                ğŸ èµ é€ç›²ç›’ (Mystery Gift)
            </div>
        </div> -->
        <div class="btn-group">
            <button class="btn-icon" @click="startBlindBox">
                ğŸ <!-- ç›²ç›’ -->
            </button>
            <button class="btn-primary" @click="startMixing(null)" style="position:relative;margin-bottom: 20px;">
                <span>Start Mixing</span> <i class="fas fa-arrow-right"></i>
            </button>
        </div>
        <div class="btn-mystery">
            <a href="Tree.html">Wish Tree>Wi>
        </div>
    </div>

    <!-- 2. è°ƒåˆ¶é¡µ: è¯—æ„å¯è§†åŒ– -->
    <div class="view-section" :class="{ active: currentView === 'mixing' }">
        <div class="mixing-container">
            <!-- åŠ¨æ€æµä½“ -->
            <div class="fluid-blob" ref="fluidBlob">
                <!-- åŠ¨æ€ç”Ÿæˆçš„ JS æ°”æ³¡ -->
            </div>
            
            <!-- è¯—æ„æˆåˆ†æç¤º (éç›´æ¥æƒ…ç»ª) -->
            <div class="poetic-ingredient">{{ currentIngredientText }}</div>
        </div>
    </div>

    <!-- 3. ç»“æœé¡µ: è‰ºæœ¯å±•ç¤º -->
    <div class="view-section" :class="{ active: currentView === 'result' }">
        <!-- èƒŒæ™¯æŠ˜å°„å±‚ (æ ¹æ®é…’çš„é¢œè‰²) -->
        <div class="bg-refraction" :style="{ background: resultBg }"></div>
        
        <div class="nav-bar" style="position:relative; z-index:2;">
            <span class="nav-icon" @click="reset">â† Back</span>
            <!-- <span class="nav-icon" @click="goToCollection">â¤æ”¶è—</span> -->
            <span class="nav-icon" @click="toggleMute" ">
                <i class="fas" :class="isMuted ? 'fa-volume-mute' : 'fa-volume-up'" transform: scale(1.1);></i>
            </span>
        </div>
        <!-- æ ¸å¿ƒè§†è§‰ï¼šé…’æ¯ - ç¼©å°ä¸€åŠ -->
        <div class="relative" style="margin: 0 auto;margin-bottom: 16px;">
            <!-- èƒŒæ™¯å‘¼å¸å…‰æ™• - åŒæ­¥ç¼©å° -->
            <div style="position: absolute; width: 100%; height: 100%; background: var(--orange-light); filter: blur(30px); border-radius: 50%;" class="animate-breathe"></div>
            
            <!-- æ¯ä½“ç»“æ„ - ç¼©å°ä¸€åŠ -->
            <div style="position: relative; width: 80px; height: 100px; border-bottom-left-radius: 6rem; border-bottom-right-radius: 6rem; border-top-left-radius: 2px; border-top-right-radius: 2px; overflow: hidden; backdrop-filter: blur(2px); border-left: 1px solid rgba(255,255,255,0.2); border-right: 1px solid rgba(255,255,255,0.2); border-bottom: 1px solid rgba(255,255,255,0.2); box-shadow: 0 0 10px rgba(0,0,0,0.2); box-sizing: border-box; background: linear-gradient(to bottom, rgba(255,255,255,0.05), transparent);">
                
                <!-- æ¶²ä½“å®¹å™¨ - é«˜åº¦æ¯”ä¾‹ä¿æŒ50% -->
                <div class="liquid-enter" style="position: absolute; bottom: 0; width: 100%; height: 60%; overflow: hidden;">
                    <!-- æ¶²ä½“æ¸å˜ - å°ºå¯¸åŒæ­¥ç¼©å° -->
                    <div style="width: 100%; height: 100%; background: linear-gradient(to top, var(--liquidStart), var(--liquidEnd), rgba(232,163,72,0.1)); opacity: 0.9; filter: blur(0.5px);" class="liquid-surface"></div>
                    
                    <!-- æ¶²ä½“é¡¶éƒ¨é«˜å…‰çº¿ - åŒæ­¥ç¼©å° -->
                    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 1px; background: rgba(255,255,255,0.3); filter: blur(0.5px);" class="liquid-surface"></div>

                    <!-- æ°”æ³¡å®¹å™¨ - å°ºå¯¸åŒæ­¥ç¼©å° -->
                    <div id="drink-bubble-container" style="position: absolute; inset: 0; pointer-events: none;"></div>
                </div>

                <!-- ç»ç’ƒåå…‰å±‚ - å°ºå¯¸åŒæ­¥ç¼©å° -->
                <div style="position: absolute; inset: 0; background: linear-gradient(to top right, transparent, transparent, rgba(255,255,255,0.1)); pointer-events: none;"></div>
            </div>
        </div>

        <!-- ä¿®æ”¹ï¼šç»™å¡ç‰‡æ·»åŠ æ·¡å…¥åŠ¨ç”»ç±» animate-fade-in-up -->
        <div class="result-glass-card animate-fade-in-up" v-if="result" style="margin-top: 5px; margin-bottom: 20px;">
            <!-- è§†è§‰å®¹å™¨ -->

            <h2 class="drink-name">{{ result.nameCN }}</h2>
            <div class="drink-en">{{ result.nameEN }}</div>

            <div style="font-size: 45px; margin-bottom: 0px; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3));">
                {{ result.visualEmoji }}
            </div>

            <div class="formula-list">
                <div class="formula-item">
                    <span class="f-key">åŸºé…’ Base</span>
                    <span class="f-val">{{ result.base }}</span>
                </div>
                <div class="formula-item">
                    <span class="f-key">æƒ…ç»ª Mood Ingredients</span>
                    <span class="f-val">{{ result.moodIngredients }}</span>
                </div>
                <div class="formula-item">
                    <span class="f-key">é£å‘³ Palate</span>
                    <span class="f-val">{{ result.palate }} {{ flavorTagsString }}</span>
                </div>
                <div class="formula-item" style="border:none; margin-top:10px; display:block;">
                    <span class="f-key" style="font-size:11px; display:block; margin-bottom:4px;">Bartender's Note</span>
                    <span class="f-val" style="font-size:14px; font-weight:300; font-style:italic; line-height:1.4;margin-top:10px;">
                        "{{ result.note }}"
                    </span>
                </div>
            </div>
        </div>

        <div class="btn-group" style="position:relative; z-index:2; margin-bottom: 20px;">
            <button class="btn-primary" @click="reset">
                <i class="fas fa-sync-alt"></i><span>å†è°ƒä¸€æ¯</span>
            </button>
            <button class="btn-icon2" @click="saveDrink">
                <i class="fas" :class="saved ? 'fa-check' : 'fa-bookmark'"></i><span>æ”¶è—é…’å•</span>
            </button>
        </div>
        <!-- <div class="btn-group">
            <button class="btn-icon" @click="startBlindBox">
                ğŸ
            </button>
            <button class="btn-primary" @click="startMixing(null)">
                <span>Start Mixing è°ƒåˆ¶</span> <i class="fas fa-arrow-right"></i>
            </button>
        </div> -->
    </div>

    <!-- 4. å†å²é¡µ: é…’å•å†å²é¡µ -->
    <div class="view-section" :class="{ active: currentView === 'history' }">
        <div class="nav-bar">
            <div style="display: flex; gap: 10px;">
                <span class="nav-icon" @click="currentView = 'home'" >
                    <i class="fa-solid fa-house"></i>
                </span>
                <span class="nav-icon" @click="goToCollection" >â¤ï¸</span>
            </div>
            <span class="subtitle">History ({{ historyRecords.length }})</span>
            
        </div>

        <div class="history-list">
            <div class="history-item" v-for="(item, index) in historyRecords" :key="index">
                <div class="h-info">
                    <h4>{{ item.nameCN }}</h4>
                    <span class="h-date">{{ item.dateStr }} Â· {{ item.timeStr }}</span>
                </div>
                <div class="h-emoji">{{ item.visualEmoji }}</div>
            </div>
            <div v-if="historyRecords.length === 0" style="text-align:center; margin-top:100px; color:rgba(255,255,255,0.2);">
                æš‚æ— å†å²è®°å½•<br>No records yet.
            </div>
        </div>
    </div>

    <!-- 5. æ”¶è—å¤¹é¡µ: ä¸»åŠ¨æ”¶è—çš„é…’æ¬¾ -->
    <div class="view-section" :class="{ active: currentView === 'collection' }">
        <div class="nav-bar">
            <div style="display: flex; gap: 10px;">
                <span class="nav-icon" @click="currentView = 'home'" >
                    <i class="fa-solid fa-house"></i>
                </span>
                <span class="nav-icon" @click="currentView = 'history'" >ğŸ“œ</span>
            </div>
            
            <!-- æ˜¾ç¤ºâ€œæ”¶è—æ•°/æ€»é…æ–¹æ•°â€ -->
            <span class="subtitle">My Collection ({{ collections.length }}/{{ totalRecipes }})</span>
        </div>

        <div class="history-list">
            <div class="history-item" v-for="(item, index) in collections" :key="index">
                <div class="h-info">
                    <h4>{{ item.nameCN }}</h4>
                    <span class="h-date">æ”¶è—äº {{ item.collectTime }}</span>
                </div>
                <div class="h-emoji">{{ item.visualEmoji }}</div>
            </div>
            <div v-if="collections.length === 0" style="text-align:center; margin-top:100px; color:rgba(255,255,255,0.2);">
                æš‚æ— æ”¶è—é…’æ¬¾<br>No collected drinks yet.
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, watch } = Vue;

    createApp({
        setup() {
            // --- çŠ¶æ€ç®¡ç† ---
            const currentView = ref('home');
            const inputText = ref('');
            const selectedFlavors = ref([]);
            const flavorOptions = ['ğŸ‹ Sour', 'ğŸ¬ Sweet', 'ğŸŒ¿ Bitter', 'ğŸŒ¶ Spicy', 'ğŸ§‚ Salty'];
            const moodOptions = ['âœ¨ å¼€å¿ƒ', 'âš¡ï¸å†…ç–š', 'ğŸŒ§ï¸ æƒ³è¦ç‹¬å¤„', 'ğŸ”¥ å‹åŠ›å±±å¤§', 'ğŸ’« çµæ„Ÿè¿¸å‘'];
            
            const saved = ref(false);

            const bubbleContainer = ref(null); // æ–°å¢ï¼šæ°”æ³¡å®¹å™¨ref
            const fluidBlob = ref(null);
            const currentIngredientText = ref('');
            const result = ref(null);
            const resultBg = ref('');
            
            // æ–°å¢ï¼šéŸ³é¢‘ç›¸å…³çŠ¶æ€
            const audio = ref(null); // éŸ³é¢‘å¯¹è±¡
            const isMuted = ref(false); // æ˜¯å¦é™éŸ³
            const currentAudioUrl = ref(''); // å½“å‰æ’­æ”¾çš„éŸ³é¢‘URL
            // å†å²è®°å½• (å®é™…å¼€å‘å¯å­˜ LocalStorage)
            // const history = ref([]);

            // 1. æ–°å¢ï¼šæ”¶è—å¤¹ï¼ˆä¸»åŠ¨ä¿å­˜çš„é…’æ¬¾ï¼Œå¯å»é‡ï¼‰
            const collections = ref([]);
            // 2. æ›¿æ¢ï¼šå†å²è®°å½•ï¼ˆè‡ªåŠ¨è®°å½•æ¯æ¬¡è°ƒåˆ¶ï¼Œå«æ—¶é—´ï¼Œä¸å¯åˆ é™¤ï¼‰
            const historyRecords = ref([]);
            

            // --- 9ç§æƒ…ç»ªé…æ–¹åº“ ---
            const recipes = {
                love: {
                    keys: ['çˆ±', 'love', 'å–œæ¬¢', 'å¿ƒåŠ¨', 'æ¸©æš–', 'sweet'],
                    nameCN: 'ç²‰çº¢å¤©é¹…ç»’ Â· æ‹¥æŠ± â¤ï¸', nameEN: 'Pink Velvet Embrace',
                    base: 'Gin æ¡ƒçº¢é‡‘é…’', moodIngredients: 'èœœæ¡ƒæœæ³¥ Â· ç«ç‘°èŠ±éœ²',
                    palate: 'ç»µå¯† / é¦™ç”œ', note: 'çˆ±æ˜¯è½¯è‚‹ï¼Œä¹Ÿæ˜¯é“ ç”²ã€‚',
                    visualEmoji: 'ğŸ·', color: '#ff9a9e',
                    ingredients: ['åŠ å…¥ ğŸŒ¸ æ™¨é—´ç«ç‘°', 'è°ƒå…¥ ğŸ¯ ä¸€å‹ºæ¸©æŸ”çš„èœœ', 'èåˆ â¤ï¸ å¿ƒè·³çš„èŠ‚å¥'],
                    audio: 'çˆ±.MP3' // ç›¸å¯¹è·¯å¾„ï¼šæ ¹ç›®å½•â†’audioæ–‡ä»¶å¤¹â†’love.mp3
                },
                jealousy: {
                    keys: ['å«‰å¦’', 'jealous', 'åƒé†‹', 'é…¸', 'ç¾¡æ…•', 'æ¨'],
                    nameCN: 'ç¿ ç»¿ä¹‹çœ¼ Â· è†æ£˜ ğŸ', nameEN: 'Green Eyed Thorn',
                    base: 'Absinthe è‹¦è‰¾é…’', moodIngredients: 'é’æŸ æ± Â· è‹¦ç“œæ¶²',
                    palate: 'é…¸æ¶© / å¼ºåŠ²', note: 'å«‰å¦’æ˜¯å¿ƒä¸­é•¿å‡ºçš„é‡è‰ï¼Œæ—¢è‹¦æ¶©åˆé¡½å¼ºã€‚',
                    visualEmoji: 'ğŸ¸', color: '#00b09b',
                    ingredients: ['æŒ¤å…¥ ğŸ‹ é…¸æ¶©çš„é’æŸ ', 'ç ”ç£¨ ğŸŒ¿ å¸¦åˆºçš„è†æ£˜', 'æ»´å…¥ ğŸ’§ ä¸€æ»´ä¸ç”˜å¿ƒ'],
                    audio: 'å«‰å¦’.MP3' // ç›¸å¯¹è·¯å¾„
                },
                shame: {
                    keys: ['æ°”','é¬¼','åŒ','ç¾è€»', 'shame', 'ä¸¢äºº', 'èº²', 'é€ƒ', 'ä¸ä»…'],
                    nameCN: 'è¿·é›¾å¹»å½± Â· éšåŒ¿ ğŸŒ«ï¸', nameEN: 'Misty Phantom Hide',
                    base: 'Sake æ¸…é…’', moodIngredients: 'è›‹ç™½éœœ Â· å†°å·æ°´',
                    palate: 'æ¸…å†· / è™šæ— ', note: 'æƒ³æ‰¾ä¸ªåœ°ç¼é’»è¿›å»ï¼Œä¸å¦‚åŒ–ä½œä¸€æ¯é›¾ã€‚',
                    visualEmoji: 'ğŸ¶', color: '#bdc3c7',
                    ingredients: ['æ”¶é›† ğŸŒ™ å‡Œæ™¨çš„æµ“é›¾', 'åŠ å…¥ â„ï¸ å†°å†·çš„è‡ªæˆ‘å®¡è§†', 'å°å­˜ ğŸ§Š æ²‰é»˜'],
                    audio: 'è‹¦.MP3' // ç›¸å¯¹è·¯å¾„
                },
                guilt: {
                    keys: ['å†…ç–š', 'guilt', 'æŠ±æ­‰', 'å¯¹ä¸èµ·', 'åæ‚”', 'æ‚”'],
                    nameCN: 'æ·±æ£•å¿æ‚” Â· æ²‰æ·€ ğŸªµ', nameEN: 'Dark Repentance',
                    base: 'Dark Rum é»‘æœ—å§†', moodIngredients: 'é»‘å·§å…‹åŠ› Â· å’–å•¡',
                    palate: 'åšé‡ / å¾®è‹¦', note: 'å†…ç–šæ˜¯çµé­‚çš„è´Ÿé‡è®­ç»ƒï¼Œä¸ºäº†æ›´å¥½çš„å‰è¡Œã€‚',
                    visualEmoji: 'ğŸ¥ƒ', color: '#3e2b26',
                    ingredients: ['èåŒ– ğŸ« è‹¦æ¶©çš„é»‘å·§', 'èƒå– â˜• æ²‰é‡çš„æ€ç»ª', 'æ²‰æ·€ ğŸ‚ è¿‡å»çš„è½å¶'],
                    audio: 'ç©ºçµ.MP3' // ç›¸å¯¹è·¯å¾„
                },
                pride: {
                    keys: ['å‘', 'è‡ªè±ª', 'pride', 'éª„å‚²', 'æ£’', 'èµ¢', 'å…‰è£'],
                    nameCN: 'çš‡å®¶è£è€€ Â· é‡‘å†  ğŸ‘‘', nameEN: 'Royal Glory Crown',
                    base: 'Champagne é¦™æ§Ÿ', moodIngredients: 'é£Ÿç”¨é‡‘ç®” Â· æ¥éª¨æœ¨èŠ±',
                    palate: 'æ°”æ³¡ / é—ªè€€', note: 'è¿™æ˜¯å±äºä½ çš„åŠ å†•æ—¶åˆ»ï¼Œå°½æƒ…é—ªè€€ã€‚',
                    visualEmoji: 'ğŸ¥‚', color: '#fadd96',
                    ingredients: ['æ’’ä¸‹ âœ¨ é—ªè€€çš„é‡‘ç²‰', 'å¼€å¯ ğŸ¾ åº†ç¥çš„æ°”æ³¡', 'æ³¨å…¥ ğŸ¦ æ˜‚æ‰¬çš„å‹‡æ°”'],
                    audio: 'è‡ªè±ª.MP3' // ç›¸å¯¹è·¯å¾„
                },
                anxiety: {
                    keys: ['ç‹¬','å¿§','ç„¦è™‘', 'anxiety', 'æ€¥', 'æ€•', 'æ‹…å¿ƒ', 'ä¹±', 'æœªæ¥'],
                    nameCN: 'æ··æ²Œæ°”æ—‹ Â· å˜¶å˜¶ âš¡', nameEN: 'Chaos Fizzy Cyclone',
                    base: 'Tequila é¾™èˆŒå…°', moodIngredients: 'è·³è·³ç³– Â· è‹æ‰“æ°´',
                    palate: 'åˆºæ¿€ / å™¼å•ªä½œå“', note: 'æ—¢ç„¶æ— æ³•å¹³é™ï¼Œå°±ä¸æ··ä¹±å…±èˆã€‚',
                    visualEmoji: 'ğŸ¹', color: '#a18cd1',
                    ingredients: ['æŠ•å…¥ ğŸ¬ èºåŠ¨çš„è·³è·³ç³–', 'æ…æ‹Œ ğŸŒªï¸ æ··ä¹±çš„æ€ç»ª', 'æŒ¤å‹ ğŸ‹ ç´§ç»·çš„ç¥ç»'],
                    audio: 'é’æ˜¥.MP3' // ç›¸å¯¹è·¯å¾„
                },
                depression: {
                    keys: ['å¤œ','å“­','å›°','ç¡','æŠ‘éƒ', 'depression', 'ç´¯', 'ä¸§', 'é»‘', 'æ— åŠ›', 'ä½è½'],
                    nameCN: 'æ·±æ¸Šå‡è§† Â· å¯‚é™ ğŸŒ‘', nameEN: 'Abyss Silent Gaze',
                    base: 'Whisky æ³¥ç…¤å¨å£«å¿Œ', moodIngredients: 'é»‘æ¸æ Â· æ´»æ€§ç‚­',
                    palate: 'çƒŸç† / å°˜åœŸæ„Ÿ', note: 'åœ¨æ·±æ¸Šåº•éƒ¨ï¼Œä¹Ÿèƒ½çœ‹è§æœ€äº®çš„æ˜Ÿã€‚',
                    visualEmoji: 'ğŸ§‰', color: '#232526',
                    ingredients: ['è¿‡æ»¤ ğŸŒ‘ é»‘å¤œçš„æ²‰é»˜', 'æµ¸æ³¡ ğŸªµ æ½®æ¹¿çš„æœ¨å¤´', 'ç­‰å¾… â³ æ—¶é—´åœæ»'],
                    audio: 'æŠ’æƒ…é›¨å¤©.MP3'
                },
                gratitude: {
                    keys: ['ä¹','å¹¸ç¦','å¼€å¿ƒ','æ„Ÿæ¿€', 'gratitude', 'è°¢è°¢', 'æ„Ÿæ©', 'å¥½äºº', 'æš–'],
                    nameCN: 'ç¥ç€æš–é˜³ Â· é¦ˆèµ  ğŸ', nameEN: 'Amber Warmth Gift',
                    base: 'Brandy ç™½å…°åœ°', moodIngredients: 'è‚‰æ¡‚ Â· çƒ¤æ©™çš®',
                    palate: 'æ¸©æš– / é¦¥éƒ', note: 'å¿ƒæ€€æ„Ÿæ¿€ï¼Œæ˜¯çµé­‚æœ€æ¸©æš–çš„å…»æ–™ã€‚',
                    visualEmoji: 'ğŸ¾', color: '#f5af19',
                    ingredients: ['çƒ˜çƒ¤ ğŸŠ æ¸©æš–çš„æ©™çš®', 'æ’’å…¥ ğŸªµ æ„Ÿæ©çš„é¦™æ–™', 'æ”¶é›† â˜€ï¸ åˆåçš„é˜³å…‰'],
                    audio: 'è‡ªè±ª.MP3'
                },
                awe: {
                    keys: ['æ•¬ç•', 'awe','é™', 'éœ‡æ’¼', 'ç¥åœ£', 'å¤§', 'ç¾', 'wow'],
                    nameCN: 'æ˜Ÿé™…å°˜åŸƒ Â· å®å¤§ ğŸŒŒ', nameEN: 'Stardust Grandeur',
                    base: 'Gin è¶è±†èŠ±é‡‘é…’', moodIngredients: 'ç´«ç½—å…° Â· é“¶ç²‰',
                    palate: 'ç©ºçµ / å¤æ‚', note: 'é¢å¯¹æµ©ç€šï¼Œæˆ‘ä»¬æ¸ºå°è€Œä¼Ÿå¤§ã€‚',
                    visualEmoji: 'ğŸ”®', color: '#667eea',
                    ingredients: ['æ•æ‰ ğŸŒ  åˆ’è¿‡çš„æµæ˜Ÿ', 'æ··åˆ ğŸŒŒ å®‡å®™çš„å°˜åŸƒ', 'å‡è§† ğŸ‘ï¸ æœªçŸ¥çš„æ·±é‚ƒ'],
                    audio: 'ç©ºçµ.MP3'
                }
            };
            // 3. æ–°å¢ï¼šæ€»é…æ–¹æ•°ï¼ˆè®¡ç®—æ‰€æœ‰é¢„è®¾é…’æ¬¾æ€»æ•°ï¼‰
            const totalRecipes = Object.keys(recipes).length; // å›ºå®šå€¼ï¼š9

            // æ–°å¢ï¼šåˆå§‹åŒ–éŸ³é¢‘
            const initAudio = () => {
                if (!audio.value) {
                    audio.value = new Audio();
                    audio.value.loop = true; // è®¾ç½®å¾ªç¯æ’­æ”¾
                    audio.value.volume = 0.3; // è®¾ç½®éŸ³é‡ï¼ˆ0-1ï¼‰
                }
            };

            // æ–°å¢ï¼šæ’­æ”¾éŸ³é¢‘
            const playAudio = (audioUrl) => {
                // å¦‚æœå½“å‰æ²¡æœ‰éŸ³é¢‘å¯¹è±¡ï¼Œå…ˆåˆå§‹åŒ–
                if (!audio.value) {
                    initAudio();
                }
                
                // å¦‚æœè¦æ’­æ”¾çš„éŸ³é¢‘å’Œå½“å‰ä¸åŒï¼Œå…ˆåœæ­¢å½“å‰éŸ³é¢‘
                if (currentAudioUrl.value !== audioUrl) {
                    stopAudio();
                    audio.value.src = audioUrl;
                    currentAudioUrl.value = audioUrl;
                }
                
                // æ’­æ”¾éŸ³é¢‘
                audio.value.play().catch(error => {
                    console.log("Audio play failed:", error);
                    // éŸ³é¢‘æ’­æ”¾å¤±è´¥æ—¶ï¼Œå¯èƒ½éœ€è¦ç”¨æˆ·äº¤äº’åæ‰èƒ½æ’­æ”¾
                    // å¯ä»¥æ˜¾ç¤ºä¸€ä¸ªæç¤ºï¼Œè®©ç”¨æˆ·ç‚¹å‡»é¡µé¢åå†æ’­æ”¾
                });
            };

            // æ–°å¢ï¼šåœæ­¢éŸ³é¢‘
            const stopAudio = () => {
                if (audio.value && !audio.value.paused) {
                    audio.value.pause();
                    audio.value.currentTime = 0; // é‡ç½®åˆ°å¼€å¤´
                }
            };

            // æ–°å¢ï¼šåˆ‡æ¢é™éŸ³çŠ¶æ€
            const toggleMute = () => {
                if (audio.value) {
                    audio.value.muted = !audio.value.muted;
                    isMuted.value = audio.value.muted;
                }
            };

            // æ–°å¢ï¼šåœ¨è§†å›¾åˆ‡æ¢æ—¶æ§åˆ¶éŸ³é¢‘
            watch(currentView, (newView, oldView) => {
                if (newView === 'result' && result.value && result.value.audio) {
                    // è¿›å…¥ç»“æœé¡µä¸”æœ‰éŸ³é¢‘æ—¶ï¼Œæ’­æ”¾å¯¹åº”çš„éŸ³é¢‘
                    playAudio(result.value.audio);
                } else if (oldView === 'result' && audio.value) {
                    // ç¦»å¼€ç»“æœé¡µæ—¶ï¼Œåœæ­¢éŸ³é¢‘
                    stopAudio();
                }
            });
            // --- é€»è¾‘æ–¹æ³• ---

            const toggleFlavor = (f) => {
                if (selectedFlavors.value.includes(f)) {
                    selectedFlavors.value = selectedFlavors.value.filter(item => item !== f);
                } else {
                    selectedFlavors.value.push(f);
                }
            };

            // æ–°å¢ï¼šç‚¹å‡»æƒ…ç»ªæ ‡ç­¾ï¼Œå¡«å……åˆ°æ–‡æœ¬æ¡†ï¼ˆå¯é€‰æ‹©â€œæ›¿æ¢â€æˆ–â€œè¿½åŠ â€ï¼‰
            const selectMoodTag = (moodText) => {
                // æ–¹å¼1ï¼šæ›¿æ¢æ–‡æœ¬æ¡†å†…å®¹ï¼ˆè¦†ç›–åŸæœ‰ï¼‰
                inputText.value = moodText;
                
                // æ–¹å¼2ï¼šè¿½åŠ æ–‡æœ¬æ¡†å†…å®¹ï¼ˆä¿ç•™åŸæœ‰ï¼Œç”¨é€—å·åˆ†éš”ï¼‰
                // inputText.value = inputText.value ? `${inputText.value}ï¼Œ${moodText}` : moodText;
            };

            const flavorTagsString = computed(() => {
                if(selectedFlavors.value.length === 0) return '';
                return '+ ' + selectedFlavors.value.map(f => f.split(' ')[1]).join(' / '); // æå–ä¸­æ–‡
            });

            // æ ¸å¿ƒåˆ†æé€»è¾‘
            const analyze = (text) => {
                let maxScore = 0;
                let matchedKey = 'awe'; // é»˜è®¤å€¼: æ•¬ç• (ä¸­æ€§ä¿åº•)

                for (const key in recipes) {
                    let score = 0;
                    recipes[key].keys.forEach(k => {
                        if (text.includes(k)) score += 5;
                    });
                    if (score > maxScore) {
                        maxScore = score;
                        matchedKey = key;
                    }
                }
                return recipes[matchedKey];
            };

            // å¼€å§‹è°ƒåˆ¶ï¼ˆå¸¸è§„æˆ–ç›²ç›’ï¼‰
            const startMixing = async (forcedProfile = null) => {
                // å¦‚æœæ˜¯å¸¸è§„æ¨¡å¼ä¸”æ²¡è¾“å…¥ï¼Œç¨å¾®æç¤ºä¸€ä¸‹ï¼ˆè¿™é‡Œç®€å•å¤„ç†ä¸ºç›´æ¥è¿‡ï¼Œç”¨é»˜è®¤ï¼‰
                let targetProfile;
                saved.value = false;
                
                if (forcedProfile) {
                    targetProfile = forcedProfile;
                } else {
                    // åˆ†æé€»è¾‘
                    targetProfile = analyze(inputText.value || 'peace'); // é»˜è®¤ç»™ç‚¹ä¸œè¥¿
                }

                currentView.value = 'mixing';

                // è®¾ç½®æ¶²ä½“é¢œè‰²
                const blob = fluidBlob.value;
                if(blob) blob.style.background = targetProfile.color;

                // æ’­æ”¾è¯—æ„æˆåˆ†åŠ¨ç”» (3æ­¥)
                const steps = targetProfile.ingredients;
                
                // GSAP åŠ¨ç”»åºåˆ—
                let tl = gsap.timeline();
                
                // æ­¥éª¤ 1
                tl.to({}, { duration: 0.1, onComplete: () => currentIngredientText.value = steps[0] })
                  .to(blob, { scale: 1.1, duration: 1.5, ease: "sine.inOut" })
                // æ­¥éª¤ 2
                  .to({}, { duration: 0.1, onComplete: () => currentIngredientText.value = steps[1] })
                  .to(blob, { scale: 0.9, rotation: 180, duration: 1.5, ease: "sine.inOut" })
                // æ­¥éª¤ 3
                  .to({}, { duration: 0.1, onComplete: () => currentIngredientText.value = steps[2] })
                  .to(blob, { scale: 1.2, rotation: 360, duration: 1.5, ease: "elastic.out(1, 0.5)" })
                // å®Œæˆ
                  .to({}, { duration: 0.5, onComplete: () => showResult(targetProfile) });
            };

            const startBlindBox = () => {
                const keys = Object.keys(recipes);
                const randomKey = keys[Math.floor(Math.random() * keys.length)];
                inputText.value = "ğŸ ç›²ç›’èµ é€: " + recipes[randomKey].nameCN; // UIä¸Šæ˜¾ç¤ºä¸€ç‚¹ç›²ç›’æ„Ÿ
                startMixing(recipes[randomKey]);
            };

            // æ–°å¢ï¼šæ°”æ³¡ç”Ÿæˆé€»è¾‘
            const createBubbles = () => {
                // æŒ‡å‘é…’æ¯çš„æ°”æ³¡å®¹å™¨ï¼ˆå”¯ä¸€IDï¼‰
                const container = document.getElementById('drink-bubble-container');
                if (!container) return;
                // æ¸…ç©ºåŸæœ‰æ°”æ³¡
                container.innerHTML = '';
                const bubbleCount = 8; // å¢åŠ æ°”æ³¡æ•°é‡ï¼Œæ›´æ˜æ˜¾

                for(let i=0; i<bubbleCount; i++) {
                    setTimeout(() => {
                        const bubble = document.createElement('div');
                        bubble.className = 'bubble';
                        // éšæœºå¤§å° (3-8px)ï¼Œæ›´å¤§æ›´æ˜æ˜¾
                        const size = Math.random() * 3 + 3 + 'px';
                        bubble.style.width = size;
                        bubble.style.height = size;
                        // éšæœºæ°´å¹³ä½ç½® (10%-90%)
                        bubble.style.left = (Math.random() * 80 + 10) + '%';
                        // éšæœºåŠ¨ç”»æ—¶é•¿ (3-6s)
                        bubble.style.animationDuration = (Math.random() * 3 + 3) + 's';
                        // éšæœºå»¶è¿Ÿ
                        bubble.style.animationDelay = Math.random() * 2 + 's';
                        
                        container.appendChild(bubble);
                    }, i * 500);
                }
            };

            const showResult = (profile) => {
                result.value = profile;
                resultBg.value = `radial-gradient(circle at center, ${profile.color} 200%, rgba(0,0,0,0) 200%)`;
                currentView.value = 'result';
                
                // æ–°å¢ï¼šè‡ªåŠ¨è®°å½•åˆ°å†å²è®°å½•ï¼ˆæ¯æ¬¡è°ƒåˆ¶éƒ½åŠ ï¼Œå«æ—¶é—´ï¼‰
                const now = new Date();
                historyRecords.value.unshift({
                    ...profile,
                    dateStr: now.toLocaleDateString(),
                    timeStr: now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                    mixTime: now.toLocaleString() // è°ƒåˆ¶æ—¶é—´
                });
                // æ–°å¢ï¼šå»¶è¿Ÿè§¦å‘æ°”æ³¡ç”Ÿæˆï¼ˆç­‰è§†å›¾åˆ‡æ¢å®Œæˆï¼‰
                setTimeout(() => {
                    createBubbles();
                }, 300);
                // æ–°å¢ï¼šæ’­æ”¾å¯¹åº”æƒ…ç»ªçš„éŸ³é¢‘
                if (profile.audio) {
                    // ç”±äºæµè§ˆå™¨çš„è‡ªåŠ¨æ’­æ”¾ç­–ç•¥ï¼Œå¯èƒ½éœ€è¦ç”¨æˆ·äº¤äº’åæ‰èƒ½æ’­æ”¾
                    // è¿™é‡Œä½¿ç”¨ setTimeout å»¶è¿Ÿæ’­æ”¾ï¼Œå¢åŠ æˆåŠŸå‡ ç‡
                    setTimeout(() => {
                        playAudio(profile.audio);
                    }, 500);
                }
            };

            const saveDrink = () => {
                // if(saved.value) return;
                // // history.value.push({ ...result.value, date: new Date() });
                
                // if(!result.value) return;
                // const now = new Date();
                // history.value.unshift({
                //     ...result.value,
                //     dateStr: now.toLocaleDateString(),
                //     timeStr: now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                // });
                // // alert("å·²æ”¶è—è‡³é…’å• â¤\nSaved to collection.");
                // saved.value = true;

                if(saved.value) return;
                if(!result.value) return;
                
                // å»é‡é€»è¾‘ï¼šé¿å…é‡å¤æ”¶è—åŒä¸€é…’æ¬¾ï¼ˆæŒ‰ nameCN åˆ¤æ–­ï¼‰
                const isExisted = collections.value.some(item => item.nameCN === result.value.nameCN);
                if (isExisted) {
                    // alert("å·²æ”¶è—è¿‡è¿™æ¬¾é…’å•¦ âœ¨");
                    saved.value = true;
                    return;
                }

                // ä¿å­˜åˆ°æ”¶è—å¤¹
                collections.value.unshift({
                    ...result.value,
                    collectTime: new Date().toLocaleString() // æ”¶è—æ—¶é—´
                });
                saved.value = true;
            };

            const goToHistory = () => {
                currentView.value = 'history';
            };

            // æ–°å¢ï¼šè·³è½¬åˆ°æ”¶è—å¤¹é¡µé¢
            const goToCollection = () => {
                currentView.value = 'collection';
            };

            const reset = () => {
                currentView.value = 'home';
                inputText.value = '';
                selectedFlavors.value = [];

                // æ–°å¢ï¼šåœæ­¢éŸ³é¢‘
                stopAudio();

                setTimeout(() => {
                    result.value = null;
                }, 500);
            };

            // æ–°å¢ï¼šå†è°ƒä¸€æ¯ - åŠ¨ç”»é‡ç½®é€»è¾‘
            const reloadAnimation = () => {
                // é¡µé¢æ·¡å‡º
                document.body.classList.add('page-fade-out');
                // æ–°å¢ï¼šåœæ­¢éŸ³é¢‘
                stopAudio();

                setTimeout(() => {
                    // é‡ç½®çŠ¶æ€
                    currentView.value = 'home';
                    inputText.value = '';
                    selectedFlavors.value = [];
                    saved.value = false;
                    result.value = null;
                    // ç§»é™¤æ·¡å‡ºç±»ï¼Œæ¢å¤é¡µé¢
                    document.body.classList.remove('page-fade-out');
                }, 500);
            };

            // åˆ›å»ºæ°”æ³¡åŠ¨æ•ˆ
            setInterval(() => {
                if (currentView.value === 'mixing' && fluidBlob.value) {
                    const b = document.createElement('div');
                    b.classList.add('bubble');
                    const size = Math.random() * 15 + 5 + 'px';
                    b.style.width = size;
                    b.style.height = size;
                    b.style.left = Math.random() * 80 + 10 + '%';
                    b.style.bottom = '10%';
                    fluidBlob.value.appendChild(b);
                    setTimeout(() => b.remove(), 4000);
                }
            }, 400);


            return {
                currentView,
                inputText,
                flavorOptions,
                selectedFlavors,
                toggleFlavor,
                flavorTagsString,
                moodOptions, // æ–°å¢ï¼šå¯¼å‡ºæƒ…ç»ªæ ‡ç­¾åˆ—è¡¨
                selectMoodTag, // æ–°å¢ï¼šå¯¼å‡ºç‚¹å‡»æ–¹æ³•
                startMixing,
                startBlindBox,
                fluidBlob,
                currentIngredientText,
                bubbleContainer, // æ–°å¢ï¼šå¯¼å‡ºæ°”æ³¡å®¹å™¨ref
                reloadAnimation, // æ–°å¢ï¼šå¯¼å‡ºé‡ç½®åŠ¨ç”»æ–¹æ³•
                result,
                resultBg,
                saveDrink,
                historyRecords, // æ›¿æ¢ï¼šåŸ history æ”¹ä¸º historyRecords
                collections,    // æ–°å¢ï¼šæ”¶è—å¤¹æ•°ç»„
                totalRecipes,   // æ–°å¢ï¼šæ€»é…æ–¹æ•°
                // history,
                goToHistory,
                goToCollection, // æ–°å¢ï¼šè·³æ”¶è—å¤¹çš„æ–¹æ³•ï¼ˆä¸‹ä¸€æ­¥å®šä¹‰ï¼‰
                reset,
                saved, // æ–°å¢ï¼šå¯¼å‡ºsavedçŠ¶æ€
                // æ–°å¢ï¼šå¯¼å‡ºéŸ³é¢‘ç›¸å…³çš„æ–¹æ³•å’ŒçŠ¶æ€
                isMuted,
                toggleMute
            };
        }
    }).mount('#app');
</script>

</body>
</html>
